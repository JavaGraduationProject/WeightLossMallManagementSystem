var H=Object.defineProperty,J=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var j=(r,t,a)=>t in r?H(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,D=(r,t)=>{for(var a in t||(t={}))W.call(t,a)&&j(r,a,t[a]);if(U)for(var a of U(t))X.call(t,a)&&j(r,a,t[a]);return r},N=(r,t)=>J(r,G(t));import{g as M,D as c,m as $,o as q,j as O,w as d,n as l,k as u,u as Y,i as Z,L as x,q as ee,x as E,ac as le,aj as ae,K as te,ai as oe,J as B,y as I,ab as ne}from"./vendor.6c10456e.js";import{p as se,d as re,r as ie,o as de}from"./index.e298dbcb.js";import{i as ue,j as me,k as pe,l as P,b as ce,n as fe}from"./user.81f71bdb.js";import{_ as be,b as ve,a as L,c as _e}from"./QueryItem.08153dac.js";import{_ as ye}from"./ListMove.8a454c07.js";import{b as $e}from"./data.cf06ecef.js";import{_ as Ve}from"./DialogForm.42204124.js";const ke=M({props:{modelValue:{type:Boolean,required:!0},beanId:{required:!0},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(r){const t=c(),a=c(),b=c(),h=$e();return(m,n)=>{const V=$("el-input"),v=$("el-form-item"),k=$("el-tree");return q(),O(Ve,{ref_key:"form",ref:b,name:m.$t("menu.user.role"),queryBean:u(ue),createBean:u(me),updateBean:u(pe),deleteBean:u(P),beanId:r.beanId,beanIds:r.beanIds,focus:t.value,initValues:()=>({}),toValues:o=>D({},o),disableDelete:o=>o.id<=1,perms:"role","model-value":r.modelValue,"onUpdate:modelValue":n[1]||(n[1]=o=>m.$emit("update:modelValue",o)),onFinished:n[2]||(n[2]=o=>m.$emit("finished")),onBeanChange:n[3]||(n[3]=o=>{var i,p,C;return(C=a.value)==null?void 0:C.setCheckedKeys((p=(i=o.permission)==null?void 0:i.split(","))!=null?p:[])}),onBeforeSubmit:n[4]||(n[4]=o=>o.permission=[...a.value.getHalfCheckedNodes(),...a.value.getCheckedNodes()].filter(i=>i.perms).map(i=>{var p;return(p=i.perms)==null?void 0:p.join(",")}).join(","))},{default:d(({values:o})=>[l(v,{prop:"name",label:m.$t("role.name"),rules:{required:!0,message:()=>m.$t("v.required")}},{default:d(()=>[l(V,{modelValue:o.name,"onUpdate:modelValue":i=>o.name=i,ref_key:"focus",ref:t,maxlength:"50"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","rules"]),l(v,{prop:"description",label:m.$t("role.description")},{default:d(()=>[l(V,{modelValue:o.description,"onUpdate:modelValue":i=>o.description=i,maxlength:"255"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(v,{prop:"permission",label:m.$t("role.permission")},{default:d(()=>[l(k,{ref_key:"tree",ref:a,data:u(h),"node-key":"key",onCheck:n[0]||(n[0]=i=>b.value.setUnsaved(!0)),"show-checkbox":"","default-expand-all":"","check-on-click-node":""},null,8,["data"])]),_:1},8,["label"])]),_:1},8,["name","queryBean","createBean","updateBean","deleteBean","beanId","beanIds","focus","initValues","toValues","disableDelete","model-value"])}}}),ge={class:"mb-3"},Se=M({setup(r){const{t}=Y(),a=c({}),b=c(),h=c(),m=c([]),n=c([]),V=c(!1),v=c(!1),k=c(),o=Z(()=>m.value.map(e=>e.id)),i=c(!1),p=async()=>{V.value=!0;try{m.value=await ce(N(D({},re(a.value)),{Q_OrderBy:b.value})),i.value=Object.values(a.value).filter(e=>e!==void 0&&e!=="").length>0||b.value!==void 0}finally{V.value=!1}};x(p);const C=({column:e,prop:s,order:_})=>{var y;s?b.value=((y=e.sortBy)!=null?y:s)+(_==="descending"?"_desc":""):b.value=void 0,p()},Q=()=>p(),z=()=>{h.value.clearSort(),ie(a.value),b.value=void 0,p()},A=()=>{k.value=void 0,v.value=!0},R=e=>{k.value=e,v.value=!0},S=async e=>{await P(e),p(),te.success(t("success"))},F=async(e,s)=>{const _=de(e,m.value,s);await fe(_.map(y=>y.id))};return(e,s)=>{const _=$("el-button"),y=$("el-popconfirm"),g=$("el-table-column"),K=$("el-table"),T=oe("loading");return q(),ee("div",null,[E("div",ge,[l(u(be),{params:a.value,onSearch:Q,onReset:z},{default:d(()=>[l(u(L),{label:e.$t("role.name"),name:"Q_Contains_name"},null,8,["label"]),l(u(L),{label:e.$t("role.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),E("div",null,[l(_,{type:"primary",icon:u(le),onClick:A},{default:d(()=>[B(I(e.$t("add")),1)]),_:1},8,["icon"]),l(y,{title:e.$t("confirmDelete"),onConfirm:s[0]||(s[0]=f=>S(n.value.map(w=>w.id)))},{reference:d(()=>[l(_,{disabled:n.value.length<=0,icon:u(ne)},{default:d(()=>[B(I(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(ye,{class:"ml-2",disabled:n.value.length<=0||i.value||u(se)("role:update"),onMove:s[1]||(s[1]=f=>F(n.value,f))},null,8,["disabled"]),l(u(ve),{name:"role",class:"ml-2"})]),ae((q(),O(K,{ref_key:"table",ref:h,data:m.value,onSelectionChange:s[2]||(s[2]=f=>n.value=f),onRowDblclick:s[3]||(s[3]=f=>R(f.id)),onSortChange:C,class:"mt-3 shadow bg-white"},{default:d(()=>[l(u(_e),{name:"role"},{default:d(()=>[l(g,{type:"selection",width:"50"}),l(g,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(g,{property:"name",label:e.$t("role.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(g,{property:"description",label:e.$t("role.description"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(g,{label:e.$t("table.action")},{default:d(({row:f})=>[l(_,{type:"text",onClick:w=>R(f.id),size:"small"},{default:d(()=>[B(I(e.$t("edit")),1)]),_:2},1032,["onClick"]),l(y,{title:e.$t("confirmDelete"),onConfirm:w=>S([f.id])},{reference:d(()=>[l(_,{type:"text",size:"small"},{default:d(()=>[B(I(e.$t("delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[T,V.value]]),l(ke,{modelValue:v.value,"onUpdate:modelValue":s[4]||(s[4]=f=>v.value=f),beanId:k.value,beanIds:u(o),onFinished:p},null,8,["modelValue","beanId","beanIds"])])}}});export{Se as default};
